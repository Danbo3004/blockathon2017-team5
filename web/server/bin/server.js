!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t){e.exports=require("react")},function(e,t){e.exports=require("react-redux")},function(e,t){e.exports=require("react-bootstrap")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("redux")},function(e,t){e.exports=require("react-qr-reader")},function(e,t,n){e.exports=n(7)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var o=n(3),a=r(o),c=n(8),u=r(c),l=(0,a.default)();l.set("view engine","ejs"),l.use(a.default.static("public")),l.use("/merchant*",u.default),l.get("/",function(e,t){t.status(200).render("../views/home.ejs")}),l.listen(3005,function(){console.log(Object({NODE_ENV:"production",PORT:3005,ADDRESS:void 0})),console.log("Hello World listening on port 3005!")})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=r(o),c=n(0),u=r(c),l=n(9),i=r(l),s=n(4),f=n(1),d=n(10),p=n(11),h=r(p),y=n(14),m=r(y),b=(n(21),a.default.Router());b.get("*",function(e,t){var n=(0,s.createStore)(h.default);n.dispatch({type:"ASSIGN_ADDRESS",address:void 0});var r={},o=i.default.renderToString(u.default.createElement(f.Provider,{store:n},u.default.createElement(d.StaticRouter,{location:e.originalUrl,context:r},u.default.createElement(m.default,{onServer:!0})))),a=n.getState();r.url?(t.writeHead(301,{Location:r.url}),t.end()):t.status(200).render("../views/index.ejs",{html:o,script:JSON.stringify(a)})}),t.default=b},function(e,t){e.exports=require("react-dom/server")},function(e,t){e.exports=require("react-router")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(12),c=r(a),u=n(13),l=r(u),i=(0,o.combineReducers)({balance:c.default,contract:l.default});t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{balance:0,tokens:0},t=arguments[1];switch(t.type){case"UPDATE_BALANCE":return r({},t.payload);default:return e}};t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{contract:{},address:""},t=arguments[1];switch(t.type){case"ASSIGN_CONTRACT":return r({},e,{contract:t.contract});case"ASSIGN_ADDRESS":return r({},e,{address:t.address});default:return e}};t.default=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(o,a){try{var c=t[o](a),u=c.value}catch(e){return void n(e)}if(!c.done)return Promise.resolve(u).then(function(e){r("next",e)},function(e){r("throw",e)});e(u)}return r("next")})}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(0),f=r(s),d=n(1),p=n(15),h=n(2),y=n(16),m=r(y),b=n(18),v=r(b),g=n(19),w=r(g),E=n(20),k=r(E),_=function(e){function t(e){a(this,t);var n=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleSelect=n.handleSelect.bind(n),n.state={activeKey:1},n}return u(t,e),i(t,[{key:"componentWillReceiveProps",value:function(e){switch(e.location.pathname){case"/merchant":this.setState({activeKey:1});break;case"/merchant/exchange":this.setState({activeKey:2});break;case"/merchant/redeem":this.setState({activeKey:3});break;case"/merchant/topup":this.setState({activeKey:4})}}},{key:"componentDidMount",value:function(){var e=this,t=void 0;t="undefined"!=typeof web3?web3.currentProvider:new Web3.providers.HttpProvider("https://rinkeby.infura.io/NLQOqKfqFUx5isRRyS4k"),window.web3=new Web3(t),fetch("/Loyalty.json",{method:"GET",headers:new Headers,mode:"cors",cache:"default"}).then(function(e){return e.json()}).then(function(){var n=o(regeneratorRuntime.mark(function n(r){var o,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o=TruffleContract(r),o.setProvider(t),n.next=4,o.at(e.props.contract.address);case 4:a=n.sent,e.props.assignContract(a),setInterval(function(){a.merchantGetToken().then(function(t){window.web3.eth.getAccounts(function(n,r){n&&console.log(n),window.web3.eth.getBalance(r[0],function(n,o){if(!n){var a=web3.fromWei(o.toNumber(),"ether");e.props.updateBalance({balance:a,tokens:parseInt(t)}),window.web3.settings.defaultAccount||(window.web3.settings.defaultAccount=r[0])}})})}).catch(function(e){return console.log(e)})},1e3);case 7:case"end":return n.stop()}},n,e)}));return function(e){return n.apply(this,arguments)}}())}},{key:"handleSelect",value:function(e){switch(this.setState({activeKey:e}),e){case 1:this.props.history.push("/merchant");break;case 2:this.props.history.push("/merchant/exchange");break;case 3:this.props.history.push("/merchant/redeem");break;case 4:this.props.history.push("/merchant/topup")}}},{key:"render",value:function(){return f.default.createElement("div",null,f.default.createElement("img",{src:"/image/banner.png"}),f.default.createElement("div",{style:{padding:"100px 50px"}},f.default.createElement(h.Nav,{bsStyle:"pills",activeKey:this.state.activeKey,onSelect:this.handleSelect,style:{display:"inline-block"}},f.default.createElement(h.NavItem,{eventKey:1},"Issue Nekoins to User"),f.default.createElement(h.NavItem,{eventKey:3},"User Redeem")),f.default.createElement(h.Nav,{bsStyle:"pills",activeKey:this.state.activeKey,onSelect:this.handleSelect,style:{float:"right"}},f.default.createElement(h.NavItem,{eventKey:4},"Topup Nekoins"),f.default.createElement(h.NavItem,{eventKey:2},"Exchange to Ethers")),f.default.createElement(p.Switch,null,f.default.createElement(p.Route,{exact:!0,path:"/merchant",component:m.default}),f.default.createElement(p.Route,{path:"/merchant/exchange",component:k.default}),f.default.createElement(p.Route,{path:"/merchant/redeem",component:v.default}),f.default.createElement(p.Route,{path:"/merchant/topup",component:w.default}))))}}]),t}(f.default.Component),O=function(e){return l({},e)},S=function(e){return{assignContract:function(t){return e({type:"ASSIGN_CONTRACT",contract:t})},updateBalance:function(t){return e({type:"UPDATE_BALANCE",payload:t})}}};t.default=(0,p.withRouter)((0,d.connect)(O,S)(_))},function(e,t){e.exports=require("react-router-dom")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(0),i=r(l),s=n(1),f=n(2),d=n(5),p=r(d),h=n(17),y=r(h),m=function(e){function t(e){o(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleError=n.handleError.bind(n),n.handleScan=n.handleScan.bind(n),n.state={token:"",scanningId:"",generatedId:""},n}return c(t,e),u(t,[{key:"handleError",value:function(e){console.log(e)}},{key:"handleScan",value:function(e){if(e){var t=[],n=[];e.split(",").forEach(function(e,r){r%2==0?t.push(parseInt(e)):n.push(parseInt(e))}),this.setState({scanningId:t[0]})}}},{key:"render",value:function(){var e=this;return i.default.createElement("div",{style:{paddingLeft:50,paddingRight:50}},i.default.createElement("h1",{style:{fontSize:30,paddingTop:50}},"You currently have ",this.props.balance.tokens," Nekoins"),i.default.createElement("form",{style:{padding:20}},i.default.createElement(f.FormGroup,{controlId:"token"},i.default.createElement(f.ControlLabel,null,"Nekoins as Gift offered to Customers"),i.default.createElement(f.FormControl,{type:"phone",placeholder:"Nekoins",style:{fontSize:"2em"},value:this.state.token,onChange:function(t){return e.setState({token:t.target.value.replace(/\D/g,"")})}}))),i.default.createElement(f.Grid,null,i.default.createElement(f.Row,{style:{position:"relative"}},i.default.createElement(f.Col,{md:6,xs:6,style:{textAlign:"center"}},i.default.createElement("h3",null,"Return customer"),i.default.createElement(p.default,{delay:300,onError:this.handleError,onScan:this.handleScan,style:{width:"80%",margin:"auto"}}),i.default.createElement("div",{style:{paddingTop:10,paddingBottom:10}},"User ID: ",this.state.scanningId),i.default.createElement(f.Button,{onClick:function(){e.props.contract.updateUser(e.state.scanningId,parseInt(e.state.token),{from:window.web3.settings.defaultAccount,to:e.props.contract.address}).then(function(e){console.log(e)})}},"Send ",""+this.state.token," Nekoins to this account")),i.default.createElement("div",{style:{position:"absolute",left:"50%",height:"100%",paddingTop:100,paddingBottom:50}},i.default.createElement("div",{style:{height:150,borderLeft:"dashed 2px black",width:1}}),i.default.createElement("div",{style:{marginTop:20,marginBottom:20}},i.default.createElement("div",{style:{position:"relative",left:-5}},"Or")),i.default.createElement("div",{style:{height:150,borderLeft:"dashed 2px black",width:1}})),i.default.createElement(f.Col,{md:6,xs:6,style:{textAlign:"center"}},i.default.createElement("h3",null,"Create new customer"),this.state.generatedId?i.default.createElement(y.default,{value:""+this.state.generatedId,size:444}):i.default.createElement("div",{style:{width:444,height:444}}),i.default.createElement(f.FormControl,{type:"password",placeholder:"Customer's password",onChange:function(t){return e.setState({password:t.target.value})},style:{marginBottom:10,margin:"0px 20px"}}),i.default.createElement(f.Button,{onClick:function(){e.props.contract.createUser(parseInt(e.state.token),parseInt(e.state.password),Math.round(1e5*Math.random()),{from:window.web3.settings.defaultAccount,to:e.props.contract.address}).then(function(t){console.log(parseInt(t.logs[0].args.uid)),e.setState({generatedId:parseInt(t.logs[0].args.uid)})})}},"Create new customer with ",""+this.state.token," Nekoins")))))}}]),t}(i.default.Component),b=function(e){return{balance:e.balance,contract:e.contract.contract}},v=function(e){return{updateTokens:function(t){return e({type:"UPDATE_TOKENS",tokens:t})}}};t.default=(0,s.connect)(b,v)(m)},function(e,t){e.exports=require("qrcode.react")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(0),i=r(l),s=n(1),f=n(2),d=n(5),p=r(d),h=function(e){function t(e){o(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleError=n.handleError.bind(n),n.handleScan=n.handleScan.bind(n),n.state={isProcessing:!1,token:""},n}return c(t,e),u(t,[{key:"handleError",value:function(e){console.log(e)}},{key:"handleScan",value:function(e){var t=this;if(console.log(e,this.state.isProcessing),!this.state.isProcessing&&e){this.setState({isProcessing:!0});var n=[],r=[];e.split(",").forEach(function(e,t){t%2==0?n.push(parseInt(e)):r.push(parseInt(e))}),this.props.contract.useToken(n,r,parseInt(this.state.token),{from:window.web3.settings.defaultAccount,to:this.props.contract.address,gas:3e5}).then(function(e){t.setState({isProcessing:!1})}).catch(function(e){console.log(e.message),t.setState({isProcessing:!1})})}}},{key:"render",value:function(){var e=this;return i.default.createElement("div",null,i.default.createElement("h1",{style:{fontSize:30,paddingTop:50}},"You currently have ",this.props.balance.tokens," Nekoins"),i.default.createElement("form",{style:{padding:20}},i.default.createElement(f.FormGroup,{controlId:"token"},i.default.createElement(f.ControlLabel,null,"Redeem Gift Code From User"),i.default.createElement(f.FormControl,{type:"text",placeholder:"Nekoins Value",value:this.state.token,onChange:function(t){return e.setState({token:t.target.value.replace(/\D/g,"")})}}))),i.default.createElement(p.default,{delay:300,onError:this.handleError,onScan:this.handleScan,style:{width:"40%",margin:"auto"}}))}}]),t}(i.default.Component),y=function(e){return{balance:e.balance,contract:e.contract.contract}},m=function(e){return{updateTokens:function(t){return e({type:"UPDATE_TOKENS",tokens:t})}}};t.default=(0,s.connect)(y,m)(h)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),l=function(e){return e&&e.__esModule?e:{default:e}}(u),i=n(1),s=n(2),f=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={token:""},n}return a(t,e),c(t,[{key:"render",value:function(){var e=this;return l.default.createElement("div",null,l.default.createElement("h1",{style:{fontSize:30,paddingTop:50}},"You currently have ",this.props.balance.tokens," Nekoins"),l.default.createElement("form",{style:{padding:20}},l.default.createElement(s.FormGroup,{controlId:"token"},l.default.createElement(s.ControlLabel,null,"Buy Nekoins for your Loyalty Program"),l.default.createElement(s.FormControl,{type:"text",placeholder:"Nekoins",value:this.state.token,onChange:function(t){return e.setState({token:t.target.value.replace(/\D/g,"")})},style:{fontSize:"2em"}})),l.default.createElement(s.Button,{onClick:function(){window.web3.eth.sendTransaction({to:e.props.contract.address,value:window.web3.toWei(e.state.token/1e4,"ether")},function(e,t){console.log(t)})}},"Buy Now!")))}}]),t}(l.default.Component),d=function(e){return{balance:e.balance,contract:e.contract.contract}},p=function(e){return{updateTokens:function(t){return e({type:"UPDATE_TOKENS",tokens:t})}}};t.default=(0,i.connect)(d,p)(f)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),l=function(e){return e&&e.__esModule?e:{default:e}}(u),i=n(1),s=n(2),f=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={token:""},n}return a(t,e),c(t,[{key:"render",value:function(){var e=this;return l.default.createElement("div",null,l.default.createElement("h1",{style:{fontSize:30,paddingTop:50}},"You currently have ",this.props.balance.tokens," Nekoins"),l.default.createElement("form",{style:{padding:20}},l.default.createElement(s.FormGroup,{controlId:"token"},l.default.createElement(s.ControlLabel,null,"Nekoins to exchange"),l.default.createElement(s.FormControl,{type:"text",placeholder:"Nekoins",value:this.state.token,onChange:function(t){return e.setState({token:t.target.value.replace(/\D/g,"")})},style:{fontSize:"2em"}})),l.default.createElement(s.Button,{onClick:function(){e.props.contract.merchantRedeemToken(e.state.token,{from:window.web3.settings.defaultAccount,to:e.props.contract.address,gas:3e5}).then(function(e){console.log(e)}).catch(function(e){return console.log(e)})}},"Exchange")))}}]),t}(l.default.Component),d=function(e){return{balance:e.balance,contract:e.contract.contract}},p=function(e){return{updateTokens:function(t){return e({type:"UPDATE_TOKENS",tokens:t})}}};t.default=(0,i.connect)(d,p)(f)},function(e,t){e.exports=require("path")}]);
//# sourceMappingURL=server.js.map